$(function(){im.init()});var im={winHei:parseInt($("#winHei").height()),state:!0,isWishCookie:0,isTouch:null,touchOneByOne:null,init:function(){var t=this;t.isWishCookie=0,t.isTouch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,t.touchOneByOne=t.isTouch?"touchstart":"click",t.setWinHei();var e=["bg1.jpg","normalmusic.svg","letter/letterMain.png"],n=["letter/img1.png","letter/img2.png","letter/img7.png","letter/img8.png","letter/xi.png","letter/xiBg.png","letter/letterT.png","letter/letterLight.png","letter/cakes.png","axle.jpg","bg2.jpg","bg3.jpg","bg4.jpg","bg5.png","bg6.jpg","bg7.jpg","bride.png","groom.png","icon.png","invite.png","letterTit.png","love.png","loveS.png","marryTit.png","musicBg.png","point.png","up.png","letterTxt/coupleImg1.png","letterTxt/star.png","letterTxt/txt1.png","letterTxt/txt2.png","letterTxt/txtBg.jpg","marryImg/coupleImg2.png","marryImg/coupleImg3.png","marryImg/coupleImg4.png","marryImg/coupleImg5.png","marryImg/coupleImg6.png","marryImg/coupleImg7.png","marryImg/coupleImg8.png","marryImg/coupleImg9.png","marryImg/coupleImg10.png","marryImg/coupleImg11.png","marryImg/coupleImg12.png","marryImg/coupleImg13.png","marryImg/txt1.png","marryImg/txt2.png","marryImg/txt3.png"];t.loadingImg("img/",[e,n]),t.doMusics().doAll(),t.clickWish()},doMusics:function(){var t=this,e=null,n=document.getElementById("closeMusic"),i=document.getElementById("audioBg"),a={doAll:function(){$(n).on(t.touchOneByOne,function(){var e=$(this),n=$(this).attr("datas");1==n?(t.state=!1,e.removeClass("musicAnim"),e.attr("datas",0),$(".switch").addClass("off"),$(i).attr("src",""),i.pause()):(t.state=!0,e.addClass("musicAnim"),e.attr("datas",1),$(".switch").removeClass("off"),$(i).attr("src","music/bg.mp3"),i.play())})},doBg:function(){e=setTimeout(function(){clearTimeout(e);try{i=document.getElementById("audioBg"),i.play()}catch(t){}},3e3)},doBtn:function(){t.state&&(audioBtn.play(),this.doBg())}};return a},setWinHei:function(){var t=this;$(".setWinHei,.column").css("height",t.winHei+"px")},swiper:function(){new Swiper(".swiper-container",{direction:"vertical"})},loadingImg:function(t,e){function n(e,n){o=0,a=!1;for(var c=e.length,r=new Image,g=0;c>g;g++)r=new Image,r.src=t+e[g],r.onload=function(){if(o++,n){if(s=Math.floor((o/c*100).toFixed(2))+"%",$("#planValue").html(s),o>=c)return a=!0,$("#loading").addClass("ot0"),setTimeout(function(){i.loadOk()},1e3),!1}else o>=c&&(a=!0)}}var i=this,a=(e[0].length,e[1].length,!1),o=0,s="0%";!function(){n(e[0],!1);var t=setInterval(function(){a&&(clearInterval(t),n(e[1],!0))},60)}()},loadOk:function(){var t=this;$("#letter").addClass("loadOk"),$("#openLetterBox").on(t.touchOneByOne,function(){$("#letter").addClass("open")}),$("#seeLetter").on(t.touchOneByOne,function(){$("#letter").addClass("see"),setTimeout(function(){$("#letter").hide(),$("#play").addClass("active")},1100)}),t.swiper(),t.switchCouple(),t.switchImg(),t.choosePath()},switchCouple:function(){function t(t){t.preventDefault(),n=t.touches[0].pageX,i=t.touches[0].pageY}function e(t){t.preventDefault(),s=t.changedTouches[0].pageX,c=t.changedTouches[0].pageY,a=s-n,o=c-i,Math.abs(a)>Math.abs(o)&&a>0?$("#switchCouple").removeClass("showWife"):Math.abs(a)>Math.abs(o)&&0>a&&$("#switchCouple").addClass("showWife"),t&&t.preventDefault&&(window.event.returnValue=!1)}{var n,i,a,o,s,c;$("#switchCouple .img1"),$("#switchCouple .img2"),$("#switchCouple .txt1")}$("#switchCouple").on("touchstart",function(e){t(e)}),$("#switchCouple").on("touchend",function(t){e(t)})},switchImg:function(){function t(t){t.preventDefault(),n=t.touches[0].pageX,i=t.touches[0].pageY}function e(t){t.preventDefault(),s=t.changedTouches[0].pageX,c=t.changedTouches[0].pageY,a=s-n,o=c-i,Math.abs(a)>Math.abs(o)&&a>0?(l--,0>l&&(l=0)):Math.abs(a)>Math.abs(o)&&0>a&&(l++,l>=g&&(l=g-1)),0!=l&&r.eq(l-1).attr("class","coupleImg rotate0 pa"),r.eq(l).attr("class","coupleImg rotate1 pa"),r.eq(l+1).attr("class","coupleImg rotate2 pa"),r.eq(l+2).attr("class","coupleImg rotate3 pa"),$("#point").attr("class","point pa w"+(l+1)),t&&t.preventDefault&&(window.event.returnValue=!1)}var n,i,a,o,s,c,r=$("#switchImg .coupleImg"),g=r.length,l=0;$("#switchImg").on("touchstart",function(e){t(e)}),$("#switchImg").on("touchend",function(t){e(t)})},choosePath:function(){var t=this,e=[{name:"sh",datas:{g:[{w1:"K469",w2:["上海南","赣州"],w3:["02-28/17:20","02-29/08:28"],w4:"历时15:08"},{w1:"K8769",w2:["赣州","瑞金"],w3:["02-29/08:47","02-29/10:16"],w4:"K469=K8769直达瑞金"}],b:[{w1:"D3147",w2:["瑞金","上海虹桥"],w3:["03-02/11:50","03-02/22:10"],w4:"历时10:20"}]}},{name:"hz",datas:{g:[{w1:"K469",w2:["杭州东","赣州"],w3:["02-28/19:34","02-29/08:28"],w4:"历时12:54"},{w1:"K8769",w2:["赣州","瑞金"],w3:["02-29/08:47","02-29/10:16"],w4:"K469=K8769直达瑞金"}],b:[{w1:"D3147",w2:["瑞金","杭州东"],w3:["03-02/11:50","03-02/20:44"],w4:"历时08:54"}]}},{name:"yw",datas:{g:[{w1:"K469",w2:["义乌","赣州"],w3:["02-28/21:09","02-29/08:28"],w4:"历时11:19"},{w1:"K8769",w2:["赣州","瑞金"],w3:["02-29/08:47","02-29/10:16"],w4:"K469=K8769直达瑞金"}],b:[{w1:"K8724",w2:["瑞金","南昌"],w3:["03-02/11:12","03-02/18:41"],w4:"历时07:29"},{w1:"G1306",w2:["南昌西","义乌"],w3:["03-02/19:43","03-02/21:43"],w4:"历时02:00"}]}},{name:"sz",datas:{g:[{w1:"未知",w2:["深圳","寻乌"],w3:["02-29/06:00","02-29/24:00"],w4:"没有合适的火车,可以坐汽车"},{w1:"K8723",w2:["赣州","瑞金"],w3:["02-29/12:31","02-29/14:00"],w4:"历时01:29"},{w1:"汽车",w2:["瑞金","寻乌澄江"],w3:["02-29/15:20","02-29/17:30"],w4:"到寻乌澄江下车"}],b:[{w1:"D6574",w2:["瑞金","赣州"],w3:["03-02/11:00","03-02/11:56"],w4:"历时00:56"},{w1:"Z107",w2:["赣州","深圳"],w3:["03-02/12:22","03-02/17:51"],w4:"历时05:29"}]}},{name:"lj",datas:{g:[{w1:"去桐畈",w2:["无","无"],w3:["无","无"],w4:"去桐畈参加正月初6的婚宴"}],b:[{w1:"无",w2:["无","无"],w3:["无","无"],w4:"自行返回"}]}}];t.setTraffic("sh",e),$("#isAudit").change(function(){var n=$(this)[0].selectedIndex,i=$(this)[0].options[n].value;t.setTraffic(i,e)})},setTraffic:function(t,e){var n,i=$("#goWayBox"),a=$("#backWayBox");i.children(".c").remove(),a.children(".c").remove();for(var o=0;o<e.length;o++)if(e[o].name==t){for(var s=e[o].datas,c=s.g.length,r=s.b.length,g=0;c>g;g++){var l=s.g[g];n='<tr class="c"><td>'+l.w1+"</td><td><div>"+l.w2[0]+'</div><div class="end-s">'+l.w2[1]+"</div></td><td><div>"+l.w3[0]+'</div><div class="end-t">'+l.w3[1]+"</div></td><td>"+l.w4+"</td></tr>",i.append(n)}for(var u=0;r>u;u++){var l=s.b[u];n='<tr class="c"><td>'+l.w1+"</td><td><div>"+l.w2[0]+'</div><div class="end-s">'+l.w2[1]+"</div></td><td><div>"+l.w3[0]+'</div><div class="end-t">'+l.w3[1]+"</div></td><td>"+l.w4+"</td></tr>",a.append(n)}return!1}},clickWish:function(){var t=this,e=new Date;e.setTime(e.getTime()+2592e6);for(var n=document.cookie,i=0,a=n.split(";"),o=0;o<a.length;o++){var s=a[o].split("=");if("isWishCookie"==s[0]){i=s[1];break}}parseInt(i)&&$("#WishLive").addClass("on"),$("#WishLive").on(t.touchOneByOne,function(){var n=$(this);parseInt(i)||t.isWishCookie?console.log("您已经祝福过了，谢谢您的祝福！"):(t.isWishCookie=1,$.getJSON("setWish.php",function(i){0==i.Code&&(document.cookie="isWishCookie="+t.isWishCookie+"; expires="+e.toGMTString(),n.addClass("on"),$("#WishVal").html(parseInt($("#WishVal").html())+1))}))})},shareFN:function(){$("#share,#share2").on("touchstart",function(){var t='<div id="shareTipsBox"><div class="tipsImg"></div><div class="clBox"></div></div>';$("body").append(t),$("#shareTipsBox").on("touchstart",function(){$(this).remove()})})}};