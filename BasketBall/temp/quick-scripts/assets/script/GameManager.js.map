{"version":3,"sources":["GameManager.js"],"names":["Basket","require","Ball","Shadow","Score","SoundManager","TimeManager","animShoot","Global","cc","Class","extends","Component","properties","ball","Prefab","shadow","basket","startPosition","Vec2","score","soundMng","timeMng","shootAnim","shootBtn","Node","people","overLayer","proBar","ProgressBar","overPop","Label","onLoad","init","newBall","initCollisionSys","setScore","W_GAME_STATE","R_GAME_STATE","NORMAL","ballComp","time_i","ballBox","getChildByName","dribble","shoot","ballPool","NodePool","i","put","instantiate","enableInput","shootBtnControl","collisionManager","director","getCollisionManager","enabled","setDisplayStats","get","addChild","setPosition","setLocalZOrder","active","getComponent","newShadow","ballShadow","pool","hasObject","getFromPool","node","shadowComp","bindShadow","self","began","ended","cur_","on","event","schedule","unschedule","log","anim1","Animation","stop","anim2","play","startMoveBasket","startMove","stopMoveBasket","stopMove","enable","node_","eventManager","resumeTarget","pauseTarget","desPipe","gameOver","string","SCORE","startGame","loadScene"],"mappings":"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","file":"GameManager.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["var Basket = require('Basket');\nvar Ball = require('Ball');\nvar Shadow = require('Shadow');\nvar Score = require('Score');\nvar SoundManager = require('SoundManager');\nvar TimeManager = require('TimeManager');\n//var shootControl = require('shootControl');\nvar animShoot = require('animShoot');\nvar Global = require('Global');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        ball: cc.Prefab,\n        shadow: cc.Prefab,\n        basket: Basket,\n        startPosition: cc.Vec2,\n        score: Score,\n        soundMng: SoundManager,\n        timeMng: TimeManager,\n        //投篮动画对象\n        shootAnim:animShoot,\n        //点击按钮控制发球\n        shootBtn:cc.Node,\n        //打球人物\n        people:cc.Node,\n        overLayer:cc.Node,\n        proBar:cc.ProgressBar,\n        //弹窗分数\n        overPop:cc.Label\n    },\n\n    onLoad: function () {\n        //初始化\n        this.init();\n        //创建篮球\n        this.newBall();\n        \n        this.basket.init(this);\n        this.score.init(this);\n        this.timeMng.init(this);\n        \n        //初始化碰撞系统\n        this.initCollisionSys();\n        //不通过此方法判断\n        //this.timeMng.oneSchedule();\n        this.score.setScore(0);\n        \n        Global.W_GAME_STATE = Global.R_GAME_STATE.NORMAL;\n    },\n    init:function(){\n        this.ballComp = null,\n        //计时\n        this.time_i = 1;\n        \n        this.ballBox = this.people.getChildByName('ballBox');\n        this.dribble = this.people.getChildByName('dribble');\n        this.shoot = this.people.getChildByName('shoot');\n        \n        this.ballPool = new cc.NodePool();\n        //在两个对象池创建2个对象\n        for(var i=0;i<3;i++){\n            this.ballPool.put(cc.instantiate(this.ball));\n        };\n        \n        this.enableInput(true,this.shootBtn);\n        //初始化发射控制按钮\n        this.shootBtnControl();\n    },\n    // 初始化碰撞系统\n    initCollisionSys: function(){\n        this.collisionManager = cc.director.getCollisionManager();\n        this.collisionManager.enabled = true;\n        //this.collisionManager.enabledDebugDraw = true// 开启debug绘制\n\n        cc.director.setDisplayStats(true);\n    },\n\n    // 生成篮球\n    newBall: function(){\n        /*if(cc.pool.hasObject(Ball)){\n            child = cc.pool.getFromPool(Ball).node;\n        }else{\n            child = cc.instantiate(this.ball);\n        }*/\n        this.ballComp = this.ballPool.get();\n        \n        //child.setLocalZOrder(1);\n        this.ballBox.addChild(this.ballComp);\n        //this.node.addChild(this.ballComp);\n        \n        this.ballComp.setPosition(this.startPosition);\n        \n        this.people.setLocalZOrder(100);\n        this.ballComp.setLocalZOrder(100);\n        \n        this.ballComp.active = false;\n        \n        //this.ballComp = child.getComponent('Ball');\n        this.ballComp.getComponent('Ball').init(this); // 启动篮球逻辑\n        //去掉影子\n        //this.newShadow(ballComp);\n        \n    },\n\n    newShadow: function(ball){\n        var ballShadow = null;\n        if(cc.pool.hasObject(Shadow)){\n            ballShadow = cc.pool.getFromPool(Shadow).node;\n        }else{\n            ballShadow = cc.instantiate(this.shadow);\n        }\n\n        ballShadow.setLocalZOrder(2);\n        this.node.addChild(ballShadow);\n        ballShadow.setPosition(this.startPosition);\n        var shadowComp = ballShadow.getComponent('Shadow')\n        ball.bindShadow(shadowComp);\n        shadowComp.init(this); // 启动影子逻辑\n    },\n    shootBtnControl:function(){\n        var self = this;\n        \n        var began,ended;\n        //计数器\n        function cur_(){\n            self.time_i++;\n        };\n        // 注册事件监听\n        self.shootBtn.on('touchstart',function(event){\n            self.time_i = 1;\n            //开始计数\n            self.schedule(cur_,0.1);\n            return true;\n        });\n        self.shootBtn.on('touchend',function(event){\n            //暂停计数\n            self.unschedule(cur_);\n            //此时禁用按钮\n            self.enableInput(false,self.shootBtn);\n            //传递当前计数器\n            cc.log(self.time_i);\n            //初始化投篮动画\n            self.shootAnim.init(self.ballComp.getComponent('Ball'),self.time_i);\n            \n            //隐藏当前运球人物，先手投篮动作\n            var anim1 = self.dribble.getComponent(cc.Animation);\n            anim1.stop();\n            self.dribble.active  = false;\n            self.shoot.active  = true;\n            var anim2 = self.shoot.getComponent(cc.Animation);\n            anim2.play('shoot');\n        });\n    },\n    startMoveBasket: function(){\n        this.basket.startMove();\n    },\n\n    stopMoveBasket: function(){\n        this.basket.stopMove();\n    },\n    // 控制事件是否生效\n    enableInput: function (enable,node_) {\n        if (enable) {\n            cc.eventManager.resumeTarget(node_);\n        } else {\n            cc.eventManager.pauseTarget(node_);\n        }\n    },\n    //水管，回收\n    desPipe: function(node){\n        this.ballPool.put(node);\n    },\n    // 游戏结束\n    gameOver: function(){\n        cc.log('结束了哦！');\n        //此时禁用按钮\n        this.enableInput(false,this.shootBtn);\n        //恢复篮网层级\n        //this.basket.switchMaskLineShow(false);\n        //暂停所有动画\n        //cc.director.stopAllActions();\n        //设置弹窗分数\n        this.overPop.string = \"比赛结束，你的得分是\"+ Global.SCORE +\"，恭喜获得《街篮》限量礼包，点击领取解锁游戏更多内容，分享至朋友圈还可邀请好友一起比拼！\";\n        this.overLayer.active = true;\n        \n    },\n    startGame:function(){\n        cc.director.loadScene('menu');\n    }\n   \n});\n"]}