{"version":3,"sources":["..\\..\\..\\..\\assets\\script/assets\\script\\Ball.js"],"names":["TouchStatus","cc","Enum","BEGEN","ENDED","CANCEL","BallStatus","FLY","DOWN","NONE","Global","require","Class","extends","Component","properties","emitSpeed","gravity","scale","showTime","ballRatio","ballSpeedX","p","init","game","valid","time_i","status","currentHorSpeed","currentVerSpeed","target","node","setScale","rotation","hitIn","dribble","people","getChildByName","shoot","showAnim","opacity","fade","fadeIn","runAction","doShoot","self","active","enableInput","shootBtn","x","Math","random","y","soundMng","playFlySound","doAnim","enable","node_","eventManager","resumeTarget","pauseTarget","scaleAnim","scaleTo","rotateValue","randomMinus1To1","rotateAnim","rotateBy","anim","spawn","update","dt","W_GAME_STATE","R_GAME_STATE","DEAD","_updatePosition","_checkValid","ballStatus","parent","basket","left","right","ballRadius","getBoundingBoxToWorld","width","ballLeft","convertToWorldSpaceAR","getPosition","ballRight","ballX","ballY","validTop","linePreNode","validLeft","validRight","validBot","score","addScore","playNetAnim","playHitBoardInSound","playBallInSound","timeMng","addTime","bindShadow","shadow","_changeBallStatus","_isOutScreen","removeFromParent","desPipe","anim1","getComponent","Animation","play","anim2","stop","newBall","speed","switchMaskLineShow","onCollisionEnter","other","log","tag","box","getLeft","getRight","world","radius","selfWorldPot","otherWorldPot","ratioHor","ratioVer","abs","horV","name","playHitBoardSound","aabb","preAabb","t","transform","r","position"],"mappings":"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","file":"Ball.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["var TouchStatus = cc.Enum({\n    BEGEN:  -1, // 按下\n    ENDED:  -1, // 结束\n    CANCEL: -1  // 取消\n});\n\nvar BallStatus = cc.Enum({\n    FLY:  -1, // 飞\n    DOWN: -1, // 落\n    NONE: -1  // 静止\n});\nvar Global = require('Global');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        emitSpeed: 0,   // 发射速度\n        gravity: 0,     // 重力速度\n        scale: 0,       // 缩放系数\n        showTime: 0,    // 生成篮球显示动画时间\n        ballRatio: 0,   // 球弹力，\n        //篮球在x轴的偏移速度\n        ballSpeedX:cc.p(0,0)\n    },\n\n    init: function(game){\n        this.game = game;\n        //this.registerInput();\n        \n        //this.showAnim();\n        // 是否进球了\n        this.valid = false;\n        this.time_i = 0;\n        this.status = TouchStatus.CANCEL;\n        this.currentHorSpeed = 0;\n        this.currentVerSpeed = 0;\n        this.target =  cc.p(0, 0);\n        this.node.setScale(1);\n        this.node.rotation = 0;\n        this.hitIn = false;\n        this.dribble = this.game.people.getChildByName('dribble');\n        this.shoot = this.game.people.getChildByName('shoot');\n    },\n\n    // 显示篮球\n    showAnim: function(){\n        //设置篮球初始位置\n        //this.game.people.node.x\n        this.node.opacity = 0;\n        var fade = cc.fadeIn(this.showTime);\n        this.node.runAction(fade);    \n    },\n\n    // 注册事件监听\n    /*registerInput: function(){\n        this.listener = {\n            event: cc.EventListener.TOUCH_ONE_BY_ONE,\n            onTouchBegan: function(touch, event) { // 触摸事件开始\n                this.began = touch.getLocation();\n                this.status = TouchStatus.BEGEN;\n                return true;\n            }.bind(this),\n\n            onTouchEnded: function (touch, event) { // 触摸事件结束\n                this.ended = touch.getLocation();\n                var distance = cc.pDistance(this.began, this.ended);\n                //移动值大于100 并且是往上\n                if(distance > 100 && this.began.y < this.ended.y){\n                    this.status = TouchStatus.ENDED;\n                    this.enableInput(false,this.game.shootBtn);\n                    \n                    this.currentVerSpeed = this.emitSpeed;\n                    // 记录最后触摸点,转换为父节点的坐标，根据触摸点偏移计算速度\n                    this.target =  this.node.parent.convertToNodeSpaceAR(this.ended); \n                    this.currentHorSpeed = this.target.x * 2;\n                    cc.log(this.currentHorSpeed);\n                    \n                    this.game.soundMng.playFlySound();\n\n                    this.doAnim();\n                    this.game.newBall();\n                    //控制阴影\n                    //if(this.shadow){\n                        //this.shadow.dimiss();\n                    //}\n                }else{\n                    this.status = TouchStatus.CANCEL;\n                }\n            }.bind(this),\n\n            onTouchCancelled: function (touch, event) { // 触摸事件取消\n                this.status = TouchStatus.CANCEL;\n            }.bind(this)\n        },\n        cc.eventManager.addListener(this.listener, this.node);\n    },*/\n   \n    //球发射\n    doShoot:function(time_i){\n        var self = this;\n        this.time_i = time_i;\n        \n        self.node.active = true;\n        //在按按钮结束后，控制发射动作和碰撞检测\n        self.status = TouchStatus.ENDED;\n        self.enableInput(false,self.game.shootBtn);\n        \n        //当前发射速度\n        self.currentVerSpeed = self.emitSpeed;\n        //通过判断当前按压的时间来控制\n        self.currentHorSpeed = (self.ballSpeedX.x + Math.random() * (self.ballSpeedX.y - self.ballSpeedX.x)) * 2;\n        \n        self.game.soundMng.playFlySound();\n        self.doAnim();\n        //self.game.newBall();\n    },\n    // 控制事件是否生效\n    enableInput: function (enable,node_) {\n        if (enable) {\n            cc.eventManager.resumeTarget(node_);\n        } else {\n            cc.eventManager.pauseTarget(node_);\n        }\n    },\n\n    // 篮球动画\n    doAnim: function(){\n        var scaleAnim = cc.scaleTo(1, this.scale);\n        // 随机得到一个0-1\n        var rotateValue = cc.randomMinus1To1();\n        var rotateAnim = cc.rotateBy(2, 3*360*rotateValue);\n        var anim = cc.spawn(scaleAnim,rotateAnim);\n        this.node.runAction(anim);\n    },\n\n    update: function (dt) {\n        if(Global.W_GAME_STATE == Global.R_GAME_STATE.DEAD){\n            return;\n        };\n\n        this._updatePosition(dt);\n        //this._checkValid(dt);\n    },\n    \n    _checkValid: function(dt){\n        //篮球状态不为下落，或者已经进球\n        if(this.ballStatus !== BallStatus.DOWN || this.valid){\n            return;\n        }\n        \n        var parent = this.game.node;\n        if(parent != null){\n            //获取篮筐对象\n            var basket = this.game.basket;\n            var left = basket.left;\n            var right = basket.right;\n            var ballRadius = this.node.getBoundingBoxToWorld().width/2;\n            \n            /** 统一转换成世界坐标计算进球逻辑 */\n            // 篮球的边界和中心\n            var ballLeft = parent.convertToWorldSpaceAR(this.node.getPosition()).x - ballRadius;\n            var ballRight = parent.convertToWorldSpaceAR(this.node.getPosition()).x + ballRadius;\n            var ballX = parent.convertToWorldSpaceAR(this.node.getPosition()).x;\n            var ballY = parent.convertToWorldSpaceAR(this.node.getPosition()).y;\n            \n            // 有效进球范围\n            var validTop = parent.convertToWorldSpaceAR(basket.linePreNode.getPosition()).y - ballRadius;\n            var validLeft = basket.node.convertToWorldSpaceAR(left.getPosition()).x;\n            var validRight = basket.node.convertToWorldSpaceAR(right.getPosition()).x;\n            var validBot = basket.node.convertToWorldSpaceAR(left.getPosition()).y - ballRadius * 2;\n            //进球了\n            if(ballY < validTop && ballY > validBot && ballX > validLeft && ballX < validRight){\n                this.valid = true;\n                this.game.score.addScore();\n                //网缩放动画\n                this.game.basket.playNetAnim();\n                //碰到篮筐\n                if(this.hitIn){\n                    this.game.soundMng.playHitBoardInSound();\n                }else{\n                    this.game.soundMng.playBallInSound();\n                };\n                //进球添加进度时间\n                this.game.timeMng.addTime();\n                //cc.director.loadScene('menu');\n            }\n        }\n    },\n\n    // 篮球绑定自己的影子\n    bindShadow: function(shadow){\n        this.shadow = shadow;\n    },\n\n    // 更新篮球位置\n    _updatePosition: function(dt){\n        var self = this;\n        this.node.x += dt * this.currentHorSpeed;\n        \n        this.currentVerSpeed -= dt * this.gravity;\n        this.node.y += dt * this.currentVerSpeed;\n        \n        this._changeBallStatus(this.currentVerSpeed);\n\n        if(this.ballStatus === BallStatus.NONE && this._isOutScreen()){\n            // if(!this.valid){ // 没进球将分数重置\n            //     this.game.score.setScore(0);\n            // }\n            this.node.removeFromParent();\n            //回收后重新生成\n            this.game.desPipe(this.node);\n            //this.node.stopAllActions();\n            this.valid = false;\n            //回收后重新生成\n            //cc.pool.putInPool(this);\n            \n            //隐藏当前投篮人物，显示运球\n            var anim1 = self.dribble.getComponent(cc.Animation);\n            anim1.play();\n            self.dribble.active  = true;\n            self.shoot.active  = false;\n            var anim2 = self.shoot.getComponent(cc.Animation);\n            anim2.stop('shoot');\n            \n            self.enableInput(true,self.game.shootBtn);\n            \n            this.game.newBall();\n            return;\n        }\n    },\n    \n    _isOutScreen: function(){\n        return this.node.y < -800;\n    },\n\n    // 更改篮球状态\n    _changeBallStatus: function(speed){\n        if(speed === 0 || this._isOutScreen()){\n            this.ballStatus = BallStatus.NONE;\n        } else if(speed > 0) {\n            this.ballStatus = BallStatus.FLY;\n            this.game.basket.switchMaskLineShow(false);\n        } else {\n            this.ballStatus = BallStatus.DOWN;\n            this.game.basket.switchMaskLineShow(true);\n        }\n    },\n\n    onCollisionEnter: function (other, self) {\n        \n        if(this.ballStatus === BallStatus.FLY){ // 篮球上升过程中不进行碰撞检测\n            return;\n        };\n        cc.log(other.tag);\n        if(other.tag == 666 && this.ballStatus == BallStatus.DOWN){\n            //篮球状态为下落\n            cc.log(\"赢了\");\n            this.valid = true;\n            this.game.score.addScore();\n            //网缩放动画\n            this.game.basket.playNetAnim();\n            //碰到篮筐\n            if(this.hitIn){\n                this.game.soundMng.playHitBoardInSound();\n            }else{\n                this.game.soundMng.playBallInSound();\n            };\n            //进球添加进度时间\n            this.game.timeMng.addTime();\n            return false;\n        }else{\n            var box = other.node.getComponent('CollisionBox');\n            var left = box.getLeft();\n            var right = box.getRight();\n    \n            // 碰撞系统会计算出碰撞组件在世界坐标系下的相关的值，并放到 world 这个属性里面\n            var world = self.world;\n            var radius = world.radius;\n    \n            // 换算物体世界坐标系坐标\n            var selfWorldPot = this.node.parent.convertToWorldSpaceAR(self.node.getPosition());\n            var otherWorldPot = this.game.basket.node.convertToWorldSpaceAR(other.node.getPosition());\n            var ratioHor = 0; // 横向弹性系数\n            var ratioVer = 0; // 纵向弹性系数\n    \n            // 计算竖直偏移系数，即竖直方向弹性系数\n            ratioVer = (selfWorldPot.y - otherWorldPot.y)/radius\n            // 计算水平偏移系数，即水平方向弹性系数\n            ratioHor = Math.abs(otherWorldPot.x - selfWorldPot.x)/radius;\n            // 水平方向碰撞初速度\n            var horV = this.currentHorSpeed/Math.abs(this.currentHorSpeed)*150;\n    \n            // 篮球碰到篮筐内，改变篮球横向速度为反方向\n            if((other.node.name === 'right' && this.node.x <= left) || (other.node.name === 'left' && this.node.x >= right)){\n                if(!this.hitIn){\n                    this.currentHorSpeed = this.currentHorSpeed * -1 * this.ballRatio * ratioHor + horV;\n                    this.hitIn = true;\n                }else{\n                    this.currentHorSpeed = this.currentHorSpeed * this.ballRatio * ratioHor + horV;\n                }\n            }\n    \n            // 篮球碰到篮筐外，增大横向速度\n            if((other.node.name === 'right' && this.node.x > right) || (other.node.name === 'left' && this.node.x < left)){\n                this.currentHorSpeed = this.currentHorSpeed * this.ballRatio * ratioHor + horV;\n            }\n            this.currentVerSpeed = this.currentVerSpeed * -1 * ratioVer * 0.8;\n            this.game.soundMng.playHitBoardSound();\n    \n            // 碰撞组件的 aabb 碰撞框\n            var aabb = world.aabb;\n    \n            // 上一次计算的碰撞组件的 aabb 碰撞框\n            var preAabb = world.preAabb;\n    \n            // 碰撞框的世界矩阵\n            var t = world.transform;\n    \n            // 以下属性为圆形碰撞组件特有属性\n            var r = world.radius;\n            var p = world.position;\n        }\n    },\n \n});"]}